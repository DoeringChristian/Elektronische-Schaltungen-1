\documentclass{article}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage[hidelinks]{hyperref}
\usepackage{tocloft}

\newcommand{\ir}{\text}
\renewcommand{\j}{\text j}
\DeclarePairedDelimiter\abs{\lvert}{\rvert}

\title{Elektronische Schaltungen: Interaktives Cheatsheet}
\author{Paul Thiel, Justus Rossmeier}

%\RequirePackage{latex4ei/latex4ei_unicode}

% -- begin custom TOC for circuits
\newcommand{\listcircuitname}{Liste der Schaltungen (anklicken zum hinspringen)}
\newlistof{circuit}{cir}{}
\newenvironment{circuit}[2]{%
	\refstepcounter{circuit}
	% Content in TOC
	\addcontentsline{cir}{circuit}
	{%
		\parbox{\linewidth}{%
			\begin{center}%
				\includegraphics[width=\linewidth,height=\linewidth,keepaspectratio]{#2}%
			\end{center}%
			\vspace{-3.8em}\ \\
			\begin{flushleft}%
				#1\hfill%
			\end{flushleft}
		}%
		\ \\
	}
	% Content on page
	\section{#1}
	\begin{minipage}[t]{12em}
		\ \vspace{-\baselineskip}\\
		\includegraphics[height=16em,width=\linewidth,keepaspectratio]{#2}\\
		\hyperref[listofcircuits]{\bfseries\small(zurück zur Liste)}
	\end{minipage}
	\begin{minipage}[t]{\linewidth - 12em}
}{%
	\end{minipage}
}

\renewcommand{\cftdotsep}{\cftnodots}

\let\mylistofcircuit\listofcircuit
\renewcommand{\listofcircuit}{%
	\subsection*{\listcircuitname}
	\label{listofcircuits}
	\vspace{-1.5em}
	\begin{multicols}{4}
		\mylistofcircuit
	\end{multicols}
}
% -- end

\cftpagenumbersoff{circuit}

% DOCUMENT_BEGIN ===============================================================
\begin{document}
\IfFileExists{git.id}{\input{git.id}}{}
\ifdefined\GitRevision\mydate{\GitNiceDate\ (git \GitRevision)}\fi

% Title (needs ./img/Logo.pdf)
\maketitle

\listofcircuit

\begin{circuit}{Stromspiegel mit Widerstand}{img/stromspiegel-mit-widerstand.pdf}
Annahme: Sättigung $\rightarrow V_{\ir GS1} = V_{\ir DD}-RI_{\ir IN}$\\
Überprüfe, ob Annahme korrekt\\
$\frac{I_{\ir out}}{I_{\ir in}} = \frac{(W/L)_2}{(W/L)_1}$
\end{circuit}
\begin{circuit}{Schalter (Transmission-Gate)}{img/transmission-gate.pdf}
$V_{\ir out} \approx V_{\ir in} \rightarrow$ Transistoren in Triodenbereich\\
\end{circuit}
\begin{circuit}{Transistor mit resistiver Last (Source an GND, immer +)}{img/transistor-mit-resistiver-last-1.pdf}
	%TODO ESB
	Verstärkung: $\frac{V_{\ir out}}{V_{\ir in}} = g_{\ir m1}(r_{\ir DS1}\parallel R_D)$\\
	$r_{\ir out} = r_{\ir DS1}\parallel R_D$\\
\end{circuit}
\begin{circuit}{Transistor mit resistiver Last ($V_{\ir in}$ an Source)}{img/transistor-mit-resistiver-last-2.pdf}	
	$A \approx g_mR_d$\\
	$r_\text{out} = r_{DS} \parallel R_D \approx R_D$\\
	$r_{\ir in} = R_D \frac{r_{\ir DS}\parallel \frac{1}{g_m}}{r_{\ir DS}\parallel R_D}$
	
\end{circuit}
\begin{circuit}{Transistor mit resistiver Last ($R_S$ an Source)}{img/transistor-mit-resistiver-last-3.pdf}	
	
	
\end{circuit}
\begin{circuit}{Sourceschaltung mit Stromquelle (- - -)}{img/sourceschaltung-mit-stromquelle.pdf}
%TODO ESB
Verstärkung: $\frac{V_{\ir out}}{V_{\ir in}} = -g_{\ir m1}r_{\ir DS1}$\\
$r_{\ir out} = r_{\ir DS1}$
\end{circuit}
\begin{circuit}{Sourceschaltung mit aktiver Last (- -)}{img/sourceschaltung-mit-aktiver-last.pdf}
%TODO ESB
Verstärkung: $\frac{V_{\ir out}}{V_{\ir in}} = -g_{\ir m1}(r_{\ir DS1}\parallel r_{\ir DS2})$\\
$r_{\ir out} = r_{\ir DS1}\parallel r_{\ir DS2}$
\end{circuit}
\begin{circuit}{Sourceschaltung mit Diodenlast [$V_{\ir in}$ am unteren Transistor (-)]}{img/sourceschaltung-mit-diodenlast-1.pdf}
	%TODO ESB
	Verstärkung: $\frac{V_{\ir out}}{V_{\ir in}} = -g_{\ir m1}\left( r_{\ir DS1}\parallel r_{\ir DS2}\parallel \frac{1}{g_{\ir m2}}\right)$\\
	$r_{\ir out} = r_{\ir DS1}\parallel r_{\ir DS2}\parallel \frac{1}{g_{\ir m2}}$
\end{circuit}
\begin{circuit}{Sourceschaltung mit Diodenlast [$V_{\ir in}$ am oberen Transistor]}{img/sourceschaltung-mit-diodenlast-2.pdf}

\end{circuit}
\begin{circuit}{Drainschaltung mit aktiver Last [ohne $C_L$ ($\approx 1$)]}{img/drainschaltung-mit-aktiver-Last-1.pdf}
	Verstärkung: $\frac{V_{\ir out}}{V_{\ir in}} = \frac{g_{\ir m1}(r_{\ir DS1}\parallel r_{\ir DS2})}{1 + g_{\ir m1}(r_{\ir DS1}\parallel r_{\ir DS2})}$ (kann auch $<1$ sein)\\
	$r_{\ir out} = \frac{r_{\ir DS1}\parallel r_{\ir DS2}}{1 + g_{\ir m1}(r_{\ir DS1}\parallel r_{\ir DS2})}$
\end{circuit}
\begin{circuit}{Drainschaltung mit aktiver Last [mit $C_L$]}{img/drainschaltung-mit-aktiver-Last-2.pdf}
	%TODO ESB
	Verstärkung: $A(\omega) = \frac{g_{\ir m1}(r_{\ir DS1}\parallel r_{\ir DS2})}{1 + g_{\ir m1}(r_{\ir DS1}\parallel r_{\ir DS2})+\j\omega C_L(r_{\ir DS1}\parallel r_{\ir DS2})}$\\
	Näherung: $\frac{g_{\ir m1}}{g_{\ir m1}+\j\omega C_L}$\\
	Betrag: $\abs{A(\omega)} = \frac{1}{\sqrt{1+(\omega C_L / g_{\ir m1})^2}}$\\
	Phase: $\phi(A(\omega) = \arctan{(-\omega C_L / g_{\ir m1})}$\\

%\end{circuit}
%\begin{circuit}{Differenzstufe mit Stromspiegel-Last (pMOS)}{img/differenzstufe-mit-stromspiegel-last-1.pdf}

\end{circuit}
\begin{circuit}{Differenzstufe mit Diodenlast}{img/differenzstufe-mit-diodenlast.pdf}
$A \approx -\frac{g_{m1}}{g_{m2}}$\\
$r_{out}=r_{DS1}\parallel r_{DS2}\parallel \frac{1}{g_{m2}} \approx \frac{1}{g_{m2}}$

\end{circuit}
\begin{circuit}{Stromspiegel mit Stromquelle}{img/stromspiegel-mit-stromquelle.pdf}
$I_\text{out} = I_\text{in}\frac{W_2}{L_2}\frac{L_1}{W_1}$\\
$r_\text{in} = r_\text{DS1} \parallel \frac{1}{g_{m1}} \approx \frac{1}{g_{m1}}$\\
$r_\text{out} = r_\text{DS2}$\\

\end{circuit}
\begin{circuit}{Differenzstufe mit resistiver Last}{img/differenzstufe-mit-resistiver-last.pdf}
$A_\text{diff} = -g_\text{m1}(r_\text{DS1}\parallel R_\text{D})\approx -g_mR_D$\\
$A_\text{cm} = -\frac{R_\text{D}}{2r_\text{ds0}}$\\
Bedingung für Sättigungsbereich:\\
$V_\text{GS1} + V_\text{GS3} - V_\text{th} \leq V_\text{in} \leq V_\text{out-} + V_\text{th}$


\end{circuit}
\begin{circuit}{Differenzstufe mit Stromspiegel-Last (nMOS)}{img/differenzstufe-mit-stromspiegel-last-2.pdf}

\end{circuit}
\begin{circuit}{Differenzstufe mit Diodenlast}{img/Logo.pdf}

\end{circuit}
\begin{circuit}{x1}{img/Logo.pdf}

\end{circuit}
\begin{circuit}{x2}{img/Logo.pdf}

\end{circuit}
\begin{circuit}{x3}{img/Logo.pdf}

\end{circuit}
\begin{circuit}{Invertierender Verstärker}{img/invertierender-verstärker.pdf}
%TODO ESB
Verstärkung (ideal): $A = -\frac{R_2}{R_1}$\\
Verstärkung (real): $A = -\frac{A\frac{R_2}{R_1+R_2}}{1+A\frac{R_1}{R_1+R_2}}$\\
Ausgangswiderstand: $r_{\ir out} = 0$\\
Eingangswiderstand: $r_{\ir in} = R_1$\\

\end{circuit}
\begin{circuit}{Invertierender Verstärker mit Offset}{img/invertierender-verstärker-mit-offset.pdf}
	Ausgangsspannung (ideal): $-\frac{R_2}{R_1}V_{\ir in}+\left( 1+\frac{R_2}{R_1}\right)V_{\ir os}$\\
	Ausgangsspannung (real): $-\frac{A\frac{R_2}{R_1+R_2}}{1+A\frac{R_1}{R_1+R_2}}V_{\ir in}+\frac{A}{1+A\frac{R_1}{R_1+R_2}}V_{\ir os}$


\end{circuit}
\begin{circuit}{Nichtinvertierender Verstärker}{img/nichtinvertierender-verstärker.pdf}
\subsection{$V_{\ir ref} = 0$}
Verstärkung (ideal): $A = 1 + \frac{R_2}{R_1}$\\
Verstärkung (real): $A = \frac{A}{1+A\frac{R_1}{R_1+R_2}}$\\
Ausgangswiderstand: $r_{\ir out} = 0$\\
Eingangswiderstand: $r_{\ir in} = \infty$\\
\subsection{$V_{\ir ref} \neq 0$}
$A=\frac{V_{\ir out,max}-V_{\ir ref}}{V_{\ir in}-V_{\ir ref}}$


\end{circuit}
\begin{circuit}{Summierverstärker}{img/summierverstärker.pdf}
Ausgangsspannung: $V_{\ir out} = - \sum_{k=1}^N V{\ir ein,k}\frac{R_3}{R_k}$\\
Fall $k=2$: $-\left( \frac{V_{\ir in,1}}{R_1} + \frac{V_{\ir in,2}}{R_2}R_3\right)$\\ 
Verstärkung (real): $A = \frac{A}{1+A\frac{R_1}{R_1+R_2}}$\\
Ausgangswiderstand: $r_{\ir out} = 0$\\
Eingangswiderstand: $r_{\ir in} = \infty$\\

\end{circuit}
\begin{circuit}{Differenzverstärker}{img/differenzverstärker.pdf}
Ausgangsspannung: $V_{\ir out} = V_{\ir in,p}\frac{R_4}{R_3+R_4} \frac{R_1+R_2}{R_1} - \frac{R_2}{R_1} V_{\ir in,p}$\\
Fall $R_3 = R_4$ und $R_1 = R_2$: $V_{\ir out} = V_{\ir in,p} - V_{\ir in,p}$

\end{circuit}
\begin{circuit}{Miller Operationsverstärker}{img/miller-op.pdf}
%TODO ESB
Verstärkung Ausgangsstufe: $A = g_{\ir m5}(r_{\ir DS5}\parallel r_{\ir DS6})$
$C_1 = C_F(1+A) \approx C_FA$ \qquad $C_2 = C_F\left(1+\frac{1}{A}\right) \approx C_F$ \\
$C_{\ir out} = C_2 + C_L$\\
Grenzfrequenz: $f_{G1} = \frac{1}{2\pi C_1r_{\ir out,diff}}$ \quad $f_{G2} = \frac{1}{2\pi C_2r_{\ir out,ausgang}}$\\
$A_0 = g_{\ir m1}(r_{\ir DS2}\parallel r_{\ir DS4})g_{\ir m5}(r_{\ir DS5}\parallel r_{\ir DS6})$\\
Übertragungsfunktion: $A(\omega)=\frac{A_0}{\left(1+\j\frac{f}{f_1}\right)\left(1+\j\frac{f}{f_2}\right)}$\\

\end{circuit}
\begin{circuit}{Komparator}{img/komparator.pdf}
Schaltschwellen: $V_H = 1 + \frac{R_2}{R_1}V_{\ir th}$ \qquad $V_L = \left( 1 + \frac{R_2}{R_1}\right) V_{\ir th}-\frac{R_1}{R_2}V_{\ir DD}$\\
Hysterese: $V_{\ir HYS} = V_H - V_L = \frac{R_1}{R_2}V_{\ir DD}$
\end{circuit}

\begin{circuit}{AD Wandler}{img/ad-widerstand.pdf}
	Quantisierungsschritt: $\Delta = V_{\ir LSB = \frac{V_{\ir ref}}{2^n}}$\\
	Anzahl Komparatoren: $2^n-1$\\
	Unterreferenzwerte: $V_r = \frac{\ir Widerstandswert bis zur Referenz}{\ir Gesamtwiderstand}V_{\ir ref}$\\
	Quantisierungsschrittschawankung: $\Delta_{\ir meas} = V_{r_n+1}-V_{r_n}$\\
	Differentielle Nichtlinearität: $DNL(n) = \frac{\Delta_{\ir meas}-\Delta}{\Delta}$ \quad $$DNL_{\ir spec} = \frac{\max{(\Delta_{\ir meas})}-\Delta}{\Delta}$$
\end{circuit}

\begin{circuit}{DA Wandler (Stromquellen)}{img/da-stromquellen.pdf}
	$V_{\ir out} = \frac{A}{1+A}\left(V_{\ir os}+\frac{RI}{8}(8b_1+4b_2+2b_3+b_4)\right)$\\
	$GE = -\frac{1}{A}$\\
\end{circuit}

\begin{circuit}{DA Wandler (Widerstände)}{img/da-widerstand.pdf}
	$V_{\ir LSB = \frac{V_{\ir ref}}{2^n}}$\\
	Unterreferenzwerte: $V_r = \frac{\ir Widerstandswert bis zur Referenz}{\ir Gesamtwiderstand}V_{\ir ref}$\\
	Quantisierungsschrittschawankung: $\Delta_{\ir meas} = V_{r_n+1}-V_{r_n}$\\
	Differentielle Nichtlinearität: $DNL(n) = \frac{\Delta_{\ir meas}-\Delta}{\Delta}$ \quad $DNL_{\ir spec} = \frac{\max{(\Delta_{\ir meas})}-\Delta}{\Delta}$\\
	$V_{\ir out,os} = V_{\ir os}$
\end{circuit}

\begin{circuit}{Low Drop-Out Regler}{img/ldo.pdf}
	$V_{\ir out} = \left( 1 + \frac{R_2}{R_1}\right) V_{\ir ref}$\\
	Falls: $R_L \ll R_1 +R_2 \Rightarrow I_L \approx \frac{V_{\ir out}}{R_L}$\\
	$\abs{V_{\ir GS,eff}} = \sqrt{\frac{2I_D}{k(W/L)}} \Rightarrow V_{\ir in} \geq V_{\ir out} + V_{\ir GS,eff}$
\end{circuit}

\begin{circuit}{Ladungspumpe}{img/ladungspumpe.pdf}
	%TODO ESBs Phase1 und 2
	Phase 1 (S1 = 23, S2 = 23): $Q_{1,A} = C_1V_{\ir DD}$ \quad $Q_{2,A} = C_2V_{\ir out}$\\
	Phase 2 (S1 = 23, S2 = 23): $Q_{1,B} = C_1(V_{\ir out}-V_{\ir in})$ \quad $Q_{2,B} = C_2V_{\ir out}$\\
	Ladungskonservierung am Ausgang: $Q_{1,A} + Q_{2,A} = Q_{1,B} + Q_{2,B}$
\end{circuit}

%TODO Spannungsfolger mit Lastwiderstand
%TODO normaler OP-Amp
%TODO evtl. Instrumentenverstärker


% DOCUMENT_END =================================================================
\end{document}